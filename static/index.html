<!--Generated by Gemini AI-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iota FaaS</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #ffffff;
            --bg-sidebar: #fcfcfc;
            --bg-panel: #f7f9fa;
            --border-color: #eaeaea;
            --text-primary: #111111;
            --text-secondary: #666666;
            --accent-green: #2ea043;
            --accent-red: #da3633;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            --font-code: 'Roboto Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-body);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            font-size: 14px;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding-top: 20px;
        }

        .sidebar-header {
            padding: 0 20px 15px 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .clear-btn {
            background: none; border: none; font-size: 10px; 
            color: var(--text-secondary); cursor: pointer; text-decoration: underline;
        }
        .clear-btn:hover { color: var(--accent-red); }

        .history-list {
            flex: 1;
            overflow-y: auto;
            list-style: none;
        }

        .history-item {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.1s;
        }

        .history-item:hover { background-color: #f0f0f0; }

        .history-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .toolbar {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
        }

        .brand { font-size: 20px; font-weight: 600; letter-spacing: -0.5px; }

        .run-btn {
            background-color: var(--text-primary);
            color: #fff;
            border: 1px solid var(--text-primary);
            padding: 8px 24px;
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .run-btn:hover { background-color: #333; transform: translateY(-1px); }
        .run-btn:disabled { background-color: #ccc; border-color: #ccc; cursor: not-allowed; transform: none; }

        .editor-wrapper {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        textarea.code-editor {
            flex: 1;
            background-color: var(--bg-panel);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            font-family: var(--font-code);
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.02);
        }

        .terminal-wrapper {
            height: 35%;
            padding: 0 30px 30px 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .terminal-output {
            flex: 1;
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            font-family: var(--font-code);
            font-size: 13px;
            overflow-y: auto;
            white-space: pre-wrap;
            color: #333;
        }

        .status-dot { height: 6px; width: 6px; border-radius: 50%; display: inline-block; }
        .dot-success { background: var(--accent-green); }
        .dot-error { background: var(--accent-red); }
        
        .meta-tag {
            display: inline-block; background: #eee; padding: 2px 6px;
            border-radius: 4px; font-size: 11px; margin-right: 8px; color: #555;
        }
        .log-success { color: var(--accent-green); font-weight: 500; }
        .log-error { color: var(--accent-red); }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <span>History</span>
            <button class="clear-btn" onclick="clearHistory()">Clear</button>
        </div>
        <ul class="history-list" id="historyList"></ul>
    </aside>

    <main class="main">
        <header class="toolbar">
            <div class="brand">Iota.</div>
            <button class="run-btn" id="runBtn" onclick="runCode()">Run Code</button>
        </header>

        <section class="editor-wrapper">
            <span class="label">Input (Python)</span>
            <textarea id="code" class="code-editor" spellcheck="false"># Write your python code here
print("Hello from iota!")</textarea>
        </section>

        <section class="terminal-wrapper">
            <span class="label">Output</span>
            <div id="terminal" class="terminal-output">
            </div>
        </section>
    </main>

    <script>
        const terminal = document.getElementById('terminal');
        const historyList = document.getElementById('historyList');
        const STORAGE_KEY = 'iota_history_v1';

        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const history = JSON.parse(saved);
                history.forEach(item => renderHistoryItem(item));
            }
        });

        function renderHistoryItem(item) {
            const li = document.createElement('li');
            li.className = 'history-item';
            
            const lines = item.code.split('\n').filter(line => line.trim() !== '');
            const title = lines.length > 0 ? lines[0].substring(0, 22) : 'Empty Script';
            
            li.innerHTML = `
                <div style="font-family: var(--font-code); font-size: 12px;">${title}...</div>
                <div class="history-meta">
                    <span>${item.duration}ms ${item.cached ? '(Cache)' : ''}</span>
                    <span class="status-dot ${item.status ? 'dot-success' : 'dot-error'}"></span>
                </div>
            `;
            
            li.onclick = () => { 
                document.getElementById('code').value = item.code;
                if(item.output) {
                    let metaHtml = `<span class="meta-tag">Restored</span>`;
                    terminal.innerHTML = `${metaHtml}\n\n<span class="log-success">${item.output}</span>`;
                }
            };
            
            historyList.prepend(li);
        }

        function saveToStorage(newItem) {
            const saved = localStorage.getItem(STORAGE_KEY);
            let history = saved ? JSON.parse(saved) : [];
            
            history.push(newItem);
            if(history.length > 20) history.shift(); 
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }

        function clearHistory() {
            localStorage.removeItem(STORAGE_KEY);
            historyList.innerHTML = '';
        }

        async function runCode() {
            const btn = document.getElementById('runBtn');
            const code = document.getElementById('code').value;

            btn.disabled = true;
            btn.innerText = "Running...";
            terminal.innerHTML = '<span style="color: #999;">... Dispatching to worker</span>';
            
            const startTime = Date.now();

            try {
                const response = await fetch('/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();
                const duration = Date.now() - startTime;
                
                const historyItem = {
                    code: code,
                    status: !data.error,
                    duration: duration,
                    cached: data.cached,
                    output: data.output,
                    timestamp: Date.now()
                };

                renderHistoryItem(historyItem);
                saveToStorage(historyItem);

                if (data.error) {
                    terminal.innerHTML = `<span class="log-error">${data.error}</span>`;
                } else {
                    let output = data.output || "";
                    let metaHtml = `<span class="meta-tag">${duration}ms</span>`;
                    if(data.cached) metaHtml += `<span class="meta-tag">Cached ‚ö°</span>`;
                    else metaHtml += `<span class="meta-tag">Worker Exec üê≥</span>`;

                    terminal.innerHTML = `${metaHtml}\n\n<span class="log-success">${output}</span>`;
                }

            } catch (err) {
                terminal.innerHTML = `<span class="log-error">System Error: ${err.message}</span>`;
            } finally {
                btn.disabled = false;
                btn.innerText = "Run Code";
            }
        }
    </script>
</body>
</html>